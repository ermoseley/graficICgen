#!/bin/bash
# Create initial conditions for isothermal turbulent box simulations

set -euo pipefail

# --- Arguments ---
if [ "$#" -ne 1 ]; then
    echo "Usage: $0 <refinement_level>"
    exit 1
fi

LVL_MAX=$1

# --- Parameters ---
NAME="dturb"
SIZE_CU=1.0           # box size in code units
TEMP=30               # temperature (K)
MU=1.49               # mean molecular weight
DENSITY=7.0e-23       # fixed density (g/cm^3)
DTG=0.01              # dust-to-gas mass ratio
GFRAC=1.5             # decades from smallest to largest grain
NFAM=8                # number of dust families
BZ=1.0                # magnetic field strength in Gauss

# --- Paths ---
MYDIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null && pwd )"
IC_DIR="ic_${NAME}/ic_${NAME}_${LVL_MAX}"

# --- Create directory structure ---
mkdir -p "$IC_DIR"
cd "$IC_DIR"

# --- Generate ICs ---
echo "Generating ICs in $IC_DIR..."
python3 "$MYDIR/make_ic_files.py" \
    "$LVL_MAX" \
    "$SIZE_CU" \
    "$DENSITY" \
    "$TEMP" \
    "$MU" \
    "$BZ"

echo "IC generation complete."
